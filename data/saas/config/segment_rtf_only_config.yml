saas_config:
  fides_key: <instance_fides_key>
  name: Segment RTF Only
  type: segment_rtf_only
  description: A sample schema representing the Segment connector for Fides
  user_guide: https://docs.ethyca.com/user-guides/integrations/saas-integrations/segment
  version: 0.1.0

  connector_params:
    - name: domain
      default_value: platform.segmentapis.com
      description: Your Segment API URL
    - name: workspace
      description: Your Segment workspace ID
    - name: access_token
      description: Your Segment access token.
      label: Access token
      sensitive: True

  external_references:
    - name: segment_user_id
      label: User Identify Reference
      description: The user ID set up when calling the identify endpoint

  client_config:
    protocol: https
    host: <domain>
    authentication:
      strategy: bearer
      configuration:
        token: <access_token>

  test_request:
    method: GET
    path: /v1beta/workspaces/

  endpoints:
    - name: segment_user
      requests:
        read:
          param_values:
            - name: user_id
              references:
                - segment_user_id
          output: |
            {
              "segment_identity": "<user_id>"
            }
        delete:
          method: POST
          path: /v1beta/workspaces/<workspace_name>/regulations
          headers:
            - name: Content-Type
              value: application/json
          param_values:
            - name: workspace_name
              connector_param: workspace
            - name: user_id
              references:
                - dataset: <instance_fides_key>
                  field: segment_user.segment_identity
                  direction: from
          body: |
            {
              "regulation_type": "Suppress_With_Delete",
              "attributes": {
                "name": "userId",
                "values": ["<user_id>"]
              }
            }
