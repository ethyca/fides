saas_config:
  fides_key: <instance_fides_key>
  name: AppsFlyer
  type: appsflyer
  description: A sample schema representing the AppsFlyer GDPR connector for Fides
  user_guide: https://docs.ethyca.com/user-guides/integrations/saas-integrations/appsflyer
  version: 0.0.9

  connector_params:
    - name: domain
      default_value: hq1.appsflyer.com
      description: AppsFlyer API domain - Mocked on Postman
    - name: api_token_v2
      label: API Token V2
      description: Your AppsFlyer V2 API token for GDPR requests
      sensitive: True
    - name: property_id
      description: String representing the mobile app to which this request is scoped
      default_value: 1234567890


  client_config:
    protocol: https
    host: <domain>
    authentication:
      strategy: bearer
      configuration:
        token: <api_token_v2>

  test_request:
    method: GET
    path: /api/mng/apps?limit=1

  endpoints:
    - name: user
      requests:
        read:
          method: POST
          path: /api/gdpr/v1/stub
          body: |
            {
              "subject_request_id": "<external_id>",
              "subject_request_type": "access",
              "submitted_time": "2023-05-15T10:00:00Z",
              "subject_identities": [
                {
                  "identity_type": "customer_user_id",
                  "identity_value": "<email>",
                  "identity_format": "raw"
                }
              ],
              "property_id": "<property_id>"
            }
          param_values:
            - name: email
              identity: email
            - name: external_id
              identity: external_id
            - name: property_id
              connector_param: property_id
          async_config:
            strategy: polling
            configuration:
              status_request:
                method: GET
                path: /api/gdpr/v1/stub/<external_id>
                headers:
                  - name: Authorization
                    value: Bearer <api_token_v2>
                param_values:
                  - name: external_id
                    identity: external_id
              status_path: request_status
              result_request:
                method: GET
                path: /api/gdpr/v1/stub/download/<external_id>
                headers:
                  - name: Authorization
                    value: Bearer <api_token_v2>
                param_values:
                  - name: external_id
                    identity: external_id
              result_path: data
              # Polling configuration specific to AppsFlyer
              polling_interval_seconds: 3600  # Check every hour
              max_polling_attempts: 192  # 8 days * 24 hours = 192 attempts
              completion_statuses: ["completed"]
              error_statuses: ["failed", "cancelled"]
