"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GppModel=void 0;const HeaderV1_js_1=require("./section/HeaderV1.js"),Sections_js_1=require("./section/Sections.js"),TcfCaV1_js_1=require("./section/TcfCaV1.js"),TcfEuV2_js_1=require("./section/TcfEuV2.js"),UspV1_js_1=require("./section/UspV1.js"),UsNat_js_1=require("./section/UsNat.js"),UsCa_js_1=require("./section/UsCa.js"),UsVa_js_1=require("./section/UsVa.js"),UsCo_js_1=require("./section/UsCo.js"),UsUt_js_1=require("./section/UsUt.js"),UsCt_js_1=require("./section/UsCt.js"),UsFl_js_1=require("./section/UsFl.js"),UsMt_js_1=require("./section/UsMt.js"),UsOr_js_1=require("./section/UsOr.js"),UsTx_js_1=require("./section/UsTx.js"),InvalidFieldError_js_1=require("./error/InvalidFieldError.js"),DecodingError_js_1=require("./error/DecodingError.js"),HeaderV1Field_js_1=require("./field/HeaderV1Field.js"),UsDe_js_1=require("./section/UsDe.js"),UsIa_js_1=require("./section/UsIa.js"),UsNe_js_1=require("./section/UsNe.js"),UsNh_js_1=require("./section/UsNh.js"),UsNj_js_1=require("./section/UsNj.js"),UsTn_js_1=require("./section/UsTn.js");class GppModel{constructor(s){this.sections=new Map,this.encodedString=null,this.decoded=!0,this.dirty=!1,s&&this.decode(s)}setFieldValue(s,e,t){this.decoded||(this.sections=this.decodeModel(this.encodedString),this.dirty=!1,this.decoded=!0);let _=null;if(this.sections.has(s)?_=this.sections.get(s):s===TcfCaV1_js_1.TcfCaV1.NAME?(_=new TcfCaV1_js_1.TcfCaV1,this.sections.set(TcfCaV1_js_1.TcfCaV1.NAME,_)):s===TcfEuV2_js_1.TcfEuV2.NAME?(_=new TcfEuV2_js_1.TcfEuV2,this.sections.set(TcfEuV2_js_1.TcfEuV2.NAME,_)):s===UspV1_js_1.UspV1.NAME?(_=new UspV1_js_1.UspV1,this.sections.set(UspV1_js_1.UspV1.NAME,_)):s===UsNat_js_1.UsNat.NAME?(_=new UsNat_js_1.UsNat,this.sections.set(UsNat_js_1.UsNat.NAME,_)):s===UsCa_js_1.UsCa.NAME?(_=new UsCa_js_1.UsCa,this.sections.set(UsCa_js_1.UsCa.NAME,_)):s===UsVa_js_1.UsVa.NAME?(_=new UsVa_js_1.UsVa,this.sections.set(UsVa_js_1.UsVa.NAME,_)):s===UsCo_js_1.UsCo.NAME?(_=new UsCo_js_1.UsCo,this.sections.set(UsCo_js_1.UsCo.NAME,_)):s===UsUt_js_1.UsUt.NAME?(_=new UsUt_js_1.UsUt,this.sections.set(UsUt_js_1.UsUt.NAME,_)):s===UsCt_js_1.UsCt.NAME?(_=new UsCt_js_1.UsCt,this.sections.set(UsCt_js_1.UsCt.NAME,_)):s===UsFl_js_1.UsFl.NAME?(_=new UsFl_js_1.UsFl,this.sections.set(UsFl_js_1.UsFl.NAME,_)):s===UsMt_js_1.UsMt.NAME?(_=new UsMt_js_1.UsMt,this.sections.set(UsMt_js_1.UsMt.NAME,_)):s===UsOr_js_1.UsOr.NAME?(_=new UsOr_js_1.UsOr,this.sections.set(UsOr_js_1.UsOr.NAME,_)):s===UsTx_js_1.UsTx.NAME?(_=new UsTx_js_1.UsTx,this.sections.set(UsTx_js_1.UsTx.NAME,_)):s===UsDe_js_1.UsDe.NAME?(_=new UsDe_js_1.UsDe,this.sections.set(UsDe_js_1.UsDe.NAME,_)):s===UsIa_js_1.UsIa.NAME?(_=new UsIa_js_1.UsIa,this.sections.set(UsIa_js_1.UsIa.NAME,_)):s===UsNe_js_1.UsNe.NAME?(_=new UsNe_js_1.UsNe,this.sections.set(UsNe_js_1.UsNe.NAME,_)):s===UsNh_js_1.UsNh.NAME?(_=new UsNh_js_1.UsNh,this.sections.set(UsNh_js_1.UsNh.NAME,_)):s===UsNj_js_1.UsNj.NAME?(_=new UsNj_js_1.UsNj,this.sections.set(UsNj_js_1.UsNj.NAME,_)):s===UsTn_js_1.UsTn.NAME&&(_=new UsTn_js_1.UsTn,this.sections.set(UsTn_js_1.UsTn.NAME,_)),!_)throw new InvalidFieldError_js_1.InvalidFieldError(s+"."+e+" not found");_.setFieldValue(e,t),this.dirty=!0,_.setIsDirty(!0)}setFieldValueBySectionId(s,e,t){this.setFieldValue(Sections_js_1.Sections.SECTION_ID_NAME_MAP.get(s),e,t)}getFieldValue(s,e){return this.decoded||(this.sections=this.decodeModel(this.encodedString),this.dirty=!1,this.decoded=!0),this.sections.has(s)?this.sections.get(s).getFieldValue(e):null}getFieldValueBySectionId(s,e){return this.getFieldValue(Sections_js_1.Sections.SECTION_ID_NAME_MAP.get(s),e)}hasField(s,e){return this.decoded||(this.sections=this.decodeModel(this.encodedString),this.dirty=!1,this.decoded=!0),!!this.sections.has(s)&&this.sections.get(s).hasField(e)}hasFieldBySectionId(s,e){return this.hasField(Sections_js_1.Sections.SECTION_ID_NAME_MAP.get(s),e)}hasSection(s){return this.decoded||(this.sections=this.decodeModel(this.encodedString),this.dirty=!1,this.decoded=!0),this.sections.has(s)}hasSectionId(s){return this.hasSection(Sections_js_1.Sections.SECTION_ID_NAME_MAP.get(s))}deleteSection(s){!this.decoded&&null!=this.encodedString&&this.encodedString.length>0&&this.decode(this.encodedString),this.sections.delete(s),this.dirty=!0}deleteSectionById(s){this.deleteSection(Sections_js_1.Sections.SECTION_ID_NAME_MAP.get(s))}clear(){this.sections.clear(),this.encodedString="DBAA",this.decoded=!1,this.dirty=!1}getHeader(){this.decoded||(this.sections=this.decodeModel(this.encodedString),this.dirty=!1,this.decoded=!0);let s=new HeaderV1_js_1.HeaderV1;return s.setFieldValue("SectionIds",this.getSectionIds()),s.toObj()}getSection(s){return this.decoded||(this.sections=this.decodeModel(this.encodedString),this.dirty=!1,this.decoded=!0),this.sections.has(s)?this.sections.get(s).toObj():null}getSectionIds(){this.decoded||(this.sections=this.decodeModel(this.encodedString),this.dirty=!1,this.decoded=!0);let s=[];for(let e=0;e<Sections_js_1.Sections.SECTION_ORDER.length;e++){let t=Sections_js_1.Sections.SECTION_ORDER[e];if(this.sections.has(t)){let e=this.sections.get(t);s.push(e.getId())}}return s}encodeModel(s){let e=[],t=[];for(let _=0;_<Sections_js_1.Sections.SECTION_ORDER.length;_++){let i=Sections_js_1.Sections.SECTION_ORDER[_];if(s.has(i)){let _=s.get(i);e.push(_.encode()),t.push(_.getId())}}let _=new HeaderV1_js_1.HeaderV1;return _.setFieldValue("SectionIds",t),e.unshift(_.encode()),e.join("~")}decodeModel(s){if(!s||0==s.length||s.startsWith("DB")){let e=s.split("~"),t=new Map;if(e[0].startsWith("D")){let _=new HeaderV1_js_1.HeaderV1(e[0]).getFieldValue("SectionIds");if(_.length!==e.length-1)throw new DecodingError_js_1.DecodingError("Unable to decode '"+s+"'. The number of sections does not match the number of sections defined in the header.");for(let i=0;i<_.length;i++){if(""===e[i+1].trim())throw new DecodingError_js_1.DecodingError("Unable to decode '"+s+"'. Section "+(i+1)+" is blank.");if(_[i]===TcfCaV1_js_1.TcfCaV1.ID){let s=new TcfCaV1_js_1.TcfCaV1(e[i+1]);t.set(TcfCaV1_js_1.TcfCaV1.NAME,s)}else if(_[i]===TcfEuV2_js_1.TcfEuV2.ID){let s=new TcfEuV2_js_1.TcfEuV2(e[i+1]);t.set(TcfEuV2_js_1.TcfEuV2.NAME,s)}else if(_[i]===UspV1_js_1.UspV1.ID){let s=new UspV1_js_1.UspV1(e[i+1]);t.set(UspV1_js_1.UspV1.NAME,s)}else if(_[i]===UsNat_js_1.UsNat.ID){let s=new UsNat_js_1.UsNat(e[i+1]);t.set(UsNat_js_1.UsNat.NAME,s)}else if(_[i]===UsCa_js_1.UsCa.ID){let s=new UsCa_js_1.UsCa(e[i+1]);t.set(UsCa_js_1.UsCa.NAME,s)}else if(_[i]===UsVa_js_1.UsVa.ID){let s=new UsVa_js_1.UsVa(e[i+1]);t.set(UsVa_js_1.UsVa.NAME,s)}else if(_[i]===UsCo_js_1.UsCo.ID){let s=new UsCo_js_1.UsCo(e[i+1]);t.set(UsCo_js_1.UsCo.NAME,s)}else if(_[i]===UsUt_js_1.UsUt.ID){let s=new UsUt_js_1.UsUt(e[i+1]);t.set(UsUt_js_1.UsUt.NAME,s)}else if(_[i]===UsCt_js_1.UsCt.ID){let s=new UsCt_js_1.UsCt(e[i+1]);t.set(UsCt_js_1.UsCt.NAME,s)}else if(_[i]===UsFl_js_1.UsFl.ID){let s=new UsFl_js_1.UsFl(e[i+1]);t.set(UsFl_js_1.UsFl.NAME,s)}else if(_[i]===UsMt_js_1.UsMt.ID){let s=new UsMt_js_1.UsMt(e[i+1]);t.set(UsMt_js_1.UsMt.NAME,s)}else if(_[i]===UsOr_js_1.UsOr.ID){let s=new UsOr_js_1.UsOr(e[i+1]);t.set(UsOr_js_1.UsOr.NAME,s)}else if(_[i]===UsTx_js_1.UsTx.ID){let s=new UsTx_js_1.UsTx(e[i+1]);t.set(UsTx_js_1.UsTx.NAME,s)}else if(_[i]===UsDe_js_1.UsDe.ID){let s=new UsDe_js_1.UsDe(e[i+1]);t.set(UsDe_js_1.UsDe.NAME,s)}else if(_[i]===UsIa_js_1.UsIa.ID){let s=new UsIa_js_1.UsIa(e[i+1]);t.set(UsIa_js_1.UsIa.NAME,s)}else if(_[i]===UsNe_js_1.UsNe.ID){let s=new UsNe_js_1.UsNe(e[i+1]);t.set(UsNe_js_1.UsNe.NAME,s)}else if(_[i]===UsNh_js_1.UsNh.ID){let s=new UsNh_js_1.UsNh(e[i+1]);t.set(UsNh_js_1.UsNh.NAME,s)}else if(_[i]===UsNj_js_1.UsNj.ID){let s=new UsNj_js_1.UsNj(e[i+1]);t.set(UsNj_js_1.UsNj.NAME,s)}else if(_[i]===UsTn_js_1.UsTn.ID){let s=new UsTn_js_1.UsTn(e[i+1]);t.set(UsTn_js_1.UsTn.NAME,s)}}}return t}if(s.startsWith("C")){let e=new Map,t=new TcfEuV2_js_1.TcfEuV2(s);return e.set(TcfEuV2_js_1.TcfEuV2.NAME,t),(new HeaderV1_js_1.HeaderV1).setFieldValue(HeaderV1Field_js_1.HeaderV1Field.SECTION_IDS,[2]),e.set(HeaderV1_js_1.HeaderV1.NAME,t),e}throw new DecodingError_js_1.DecodingError("Unable to decode '"+s+"'")}encodeSection(s){return this.decoded||(this.sections=this.decodeModel(this.encodedString),this.dirty=!1,this.decoded=!0),this.sections.has(s)?this.sections.get(s).encode():null}encodeSectionById(s){return this.encodeSection(Sections_js_1.Sections.SECTION_ID_NAME_MAP.get(s))}decodeSection(s,e){this.decoded||(this.sections=this.decodeModel(this.encodedString),this.dirty=!1,this.decoded=!0);let t=null;this.sections.has(s)?t=this.sections.get(s):s===TcfCaV1_js_1.TcfCaV1.NAME?(t=new TcfCaV1_js_1.TcfCaV1,this.sections.set(TcfCaV1_js_1.TcfCaV1.NAME,t)):s===TcfEuV2_js_1.TcfEuV2.NAME?(t=new TcfEuV2_js_1.TcfEuV2,this.sections.set(TcfEuV2_js_1.TcfEuV2.NAME,t)):s===UspV1_js_1.UspV1.NAME?(t=new UspV1_js_1.UspV1,this.sections.set(UspV1_js_1.UspV1.NAME,t)):s===UsNat_js_1.UsNat.NAME?(t=new UsNat_js_1.UsNat,this.sections.set(UsNat_js_1.UsNat.NAME,t)):s===UsCa_js_1.UsCa.NAME?(t=new UsCa_js_1.UsCa,this.sections.set(UsCa_js_1.UsCa.NAME,t)):s===UsVa_js_1.UsVa.NAME?(t=new UsVa_js_1.UsVa,this.sections.set(UsVa_js_1.UsVa.NAME,t)):s===UsCo_js_1.UsCo.NAME?(t=new UsCo_js_1.UsCo,this.sections.set(UsCo_js_1.UsCo.NAME,t)):s===UsUt_js_1.UsUt.NAME?(t=new UsUt_js_1.UsUt,this.sections.set(UsUt_js_1.UsUt.NAME,t)):s===UsCt_js_1.UsCt.NAME?(t=new UsCt_js_1.UsCt,this.sections.set(UsCt_js_1.UsCt.NAME,t)):s===UsFl_js_1.UsFl.NAME?(t=new UsFl_js_1.UsFl,this.sections.set(UsFl_js_1.UsFl.NAME,t)):s===UsMt_js_1.UsMt.NAME?(t=new UsMt_js_1.UsMt,this.sections.set(UsMt_js_1.UsMt.NAME,t)):s===UsOr_js_1.UsOr.NAME?(t=new UsOr_js_1.UsOr,this.sections.set(UsOr_js_1.UsOr.NAME,t)):s===UsTx_js_1.UsTx.NAME?(t=new UsTx_js_1.UsTx,this.sections.set(UsTx_js_1.UsTx.NAME,t)):s===UsDe_js_1.UsDe.NAME?(t=new UsDe_js_1.UsDe,this.sections.set(UsDe_js_1.UsDe.NAME,t)):s===UsIa_js_1.UsIa.NAME?(t=new UsIa_js_1.UsIa,this.sections.set(UsIa_js_1.UsIa.NAME,t)):s===UsNe_js_1.UsNe.NAME?(t=new UsNe_js_1.UsNe,this.sections.set(UsNe_js_1.UsNe.NAME,t)):s===UsNh_js_1.UsNh.NAME?(t=new UsNh_js_1.UsNh,this.sections.set(UsNh_js_1.UsNh.NAME,t)):s===UsNj_js_1.UsNj.NAME?(t=new UsNj_js_1.UsNj,this.sections.set(UsNj_js_1.UsNj.NAME,t)):s===UsTn_js_1.UsTn.NAME&&(t=new UsTn_js_1.UsTn,this.sections.set(UsTn_js_1.UsTn.NAME,t)),t&&(t.decode(e),this.dirty=!0)}decodeSectionById(s,e){this.decodeSection(Sections_js_1.Sections.SECTION_ID_NAME_MAP.get(s),e)}toObject(){this.decoded||(this.sections=this.decodeModel(this.encodedString),this.dirty=!1,this.decoded=!0);let s={};for(let e=0;e<Sections_js_1.Sections.SECTION_ORDER.length;e++){let t=Sections_js_1.Sections.SECTION_ORDER[e];this.sections.has(t)&&(s[t]=this.sections.get(t).toObj())}return s}encode(){return(null==this.encodedString||0===this.encodedString.length||this.dirty)&&(this.encodedString=this.encodeModel(this.sections),this.dirty=!1,this.decoded=!0),this.encodedString}decode(s){this.encodedString=s,this.dirty=!1,this.decoded=!1}}exports.GppModel=GppModel;