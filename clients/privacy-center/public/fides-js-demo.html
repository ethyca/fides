<!DOCTYPE html>
<html>
  <head>
    <title>fides-js script demo page</title>

    <script src="/fides.js"></script>

    <style>
      body {
        max-width: 800px;
        margin: 16px;
      }
      pre {
        background-color: #eee;
        padding: 16px;
      }
    </style>
  </head>

  <body>
    <main>
      <h1>fides.js demo page</h1>
      <p>This page exists to demonstrate and debug the fides.js script.</p>

      <h2>Was the fides global defined?</h2>
      <pre id="has-fides"></pre>

      <h2>Consent JSON</h2>
      <pre id="consent-json"></pre>

      <h2>Consent Modal Link</h2>
      <a id="fides-consent-modal-link">Manage Consent</a>

      <h2>Consent Experience</h2>
      <pre id="consent-experience"></pre>

      <h2>Geolocation</h2>
      <pre id="consent-geolocation"></pre>

      <h2>Consent Options</h2>
      <pre id="consent-options"></pre>
    </main>
  </body>

  <script>
    (() => {
      const hasFides = typeof Fides === "object";
      document.getElementById("has-fides").textContent = String(hasFides);

      if (!hasFides) {
        return;
      }

      // Ensure we only render the consent config to the DOM once Fides is fully initialized
      let timerId = setInterval(() => {
        if (window.Fides?.initialized) {
          console.log("Fides has been initialized!");
          // Pretty-print the fides consent object and add it to the page.
          document.getElementById("consent-json").textContent = JSON.stringify(
            Fides.consent,
            null,
            2
          );

          // Pretty-print the fides experience config object and add it to the page.
          document.getElementById("consent-experience").textContent =
            JSON.stringify(Fides.experience, null, 2);

          // Pretty-print the fides geolocation object and add it to the page.
          document.getElementById("consent-geolocation").textContent =
            JSON.stringify(Fides.geolocation, null, 2);

          // Pretty-print the fides options object and add it to the page.
          document.getElementById("consent-options").textContent =
            JSON.stringify(Fides.options, null, 2);

          // Test behavior of integrations that can be configured without/before their platform scripts.
          Fides.gtm();
          Fides.meta({
            consent: Fides.consent.tracking,
            dataUse: Fides.consent.data_sales,
          });
          clearInterval(timerId);
        } else {
          console.log("Fides not yet initialized, waiting. . .");
        }
      }, 100);
    })();
  </script>
</html>
