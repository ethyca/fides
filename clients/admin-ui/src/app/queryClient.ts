import type { paths } from "@ethyca/fides-api-ts"; // generated by openapi-typescript
import { isMatch } from "lodash";
import createClient from "openapi-fetch";
import {
  createImmutableHook,
  createInfiniteHook,
  createMutateHook,
  createQueryHook,
} from "swr-openapi";

import store from "~/app/store";
import { addCommonHeaders } from "~/features/common/CommonHeaders";

// Get auth headers from redux
const getHeaders = () => {
  const headers = new Headers();
  const { token } = store.getState().auth;
  addCommonHeaders(headers, token);
  return headers;
};

const client = createClient<paths>({
  baseUrl: process.env.NEXT_PUBLIC_FIDESCTL_API?.replace("/api/v1", ""), // Should think about migrating config to not include prefix
  headers: getHeaders(),
});
const prefix = "";

export const useQuery = createQueryHook(client, prefix);
export const useImmutable = createImmutableHook(client, prefix);
export const useInfinite = createInfiniteHook(client, prefix);
export const useMutate = createMutateHook(
  client,
  prefix,
  isMatch, // Or any comparision function
);
